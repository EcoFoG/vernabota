<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="vernabota">
<title>Comparing Simulation Settings • vernabota</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparing Simulation Settings">
<meta property="og:description" content="vernabota">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">vernabota</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/vernabota.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/compare.html">Comparing Simulation Settings</a>
    <a class="dropdown-item" href="../articles/model.html">Models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/EcoFoG/vernabota/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="compare_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Comparing Simulation Settings</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EcoFoG/vernabota/blob/HEAD/vignettes/articles/compare.Rmd" class="external-link"><code>vignettes/articles/compare.Rmd</code></a></small>
      <div class="d-none name"><code>compare.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">56</span><span class="op">)</span></code></pre></div>
<p>The choice of the settings used for the gap filling is important for the quality of the estimation. It is specific to the study and the dataset of the user, so it is interesting to compare different settings and to choose the one that performs the best:</p>
<ul>
<li>choice of observation data (<em>DataAsso</em>): Using the same dataset (or a dataset to limited in its size or spatial extent) can lead to underestimating diversity as it underestimate the dispersal of species from outside. Using a too wide data set could lead to associating species that are not present in the area.</li>
<li>the choice of the prior data depends on the team that has performed the vernacular identification and on the spatial extent of the data to gapfill and of the prior.</li>
<li>the relative weights given to the prior and the observation depends on the quantity and quality of information brought by the prior and the observation.</li>
<li>the effect of the value of <span class="math inline">\(\epsilon\)</span> can also be tested.</li>
<li>the overall percentage of trees used for testing (<em>pc2fill</em>) can also be tested.</li>
<li>the percentage of trees from the test dataset (<em>pc2fill</em> percent of the total) that we consider determined to the family (<em>pcFamilyDet</em>) or to the genus (<em>pcGenusDet</em>) should logically be chosen to be similar to these in the data set we want to gapfill (but this can also be changed). The rest (100 - <em>pcFamilyDet</em> - <em>pcGenusDet</em>) is considered not determined at all.</li>
</ul>
<p>For this, we use the function <em>CompareSim</em>. This function “masks” the identification of the trees fully identified and test if it can be successfully retrieved with the setting chosen. The proportion of correct association is called accuracy.</p>
<div class="section level2">
<h2 id="preparing-the-data">Preparing the data<a class="anchor" aria-label="anchor" href="#preparing-the-data"></a>
</h2>
<p>We first prepare the data as in the <a href="vernabota.html">Introduction vignette</a>.</p>
<ul>
<li>The data we want to gapfill:</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EcoFoG/vernabota" class="external-link">vernabota</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Paracou6_2016</span><span class="op">)</span>
<span class="va">Data2fill</span> <span class="op">&lt;-</span> <span class="va">Paracou6_2016</span><span class="op">[</span><span class="va">Paracou6_2016</span><span class="op">$</span><span class="va">SubPlot</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span>
<span class="va">Data2fill</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PrepData.html">PrepData</a></span><span class="op">(</span><span class="va">Data2fill</span><span class="op">)</span></code></pre></div>
<ul>
<li>The priors:</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">PriorAllFG_20220126</span><span class="op">)</span>
<span class="va">PriorAllFG</span> <span class="op">&lt;-</span> <span class="va">PriorAllFG_20220126</span>
<span class="va">PriorAllFG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PrepPrior.html">PrepPrior</a></span><span class="op">(</span><span class="va">PriorAllFG</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">PriorParacouNew_20220126</span><span class="op">)</span>
<span class="va">PriorParacouNew</span> <span class="op">&lt;-</span> <span class="va">PriorParacouNew_20220126</span>
<span class="va">PriorParacouNew</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PrepPrior.html">PrepPrior</a></span><span class="op">(</span><span class="va">PriorParacouNew</span><span class="op">)</span></code></pre></div>
<ul>
<li>And the observed data to update the prior:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DataAsso</span> <span class="op">&lt;-</span> <span class="va">Paracou6_2016</span>
<span class="va">DataAsso</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PrepData.html">PrepData</a></span><span class="op">(</span><span class="va">DataAsso</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparing-different-settings-for-the-simulations-using-the-function-comparesim">Comparing different settings for the simulations using the function <em>CompareSim</em><a class="anchor" aria-label="anchor" href="#comparing-different-settings-for-the-simulations-using-the-function-comparesim"></a>
</h2>
<p><em>NB</em>: for these examples, a low number of simulations is used. For real tests, a higher number of simulations should be performed.</p>
<div class="section level3">
<h3 id="comparing-different-settings">Comparing different settings<a class="anchor" aria-label="anchor" href="#comparing-different-settings"></a>
</h3>
<p>We first create lists for the priors and the observation data that we want to test:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">PriorAllFG</span>, <span class="va">PriorParacouNew</span><span class="op">)</span> <span class="co"># priors</span>
<span class="va">DAsso</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="va">DataAsso</span><span class="op">)</span>               <span class="co"># observation data</span></code></pre></div>
<p>Then we create the <em>Param</em> dataframe to explicit the different scenarios to test:</p>
<ul>
<li><p>priors : a vector with the rank of the priors to use in the priors list</p></li>
<li><p>dataAsso : a vector with the rank of the observation data to use in</p></li>
<li><p>the DAsso list (if Dasso is not provided, put 1)</p></li>
<li><p>weights : a vector with the weights of the priors</p></li>
<li><p>eps : a vector with the epsilon value for each scenario</p></li>
<li><p>Determ : a vector with the value of Determ (boolean)</p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,  <span class="co"># here, we used the first prior </span>
                    <span class="co"># of the list for scenario 1, 2, 4 and 5 and the second for scenario 3</span>
                    dataAsso <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, <span class="co"># for the second scenario dataAsso is NULL (the data to gapfill are used)</span>
                    weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.2</span>,<span class="fl">0.8</span><span class="op">)</span>,
                    eps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span><span class="op">)</span>,
                    Determ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">FALSE</span>,<span class="cn">FALSE</span>,<span class="cn">FALSE</span>,<span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">Param</span>
<span class="co">#&gt;   priors dataAsso weights  eps Determ</span>
<span class="co">#&gt; 1      1        2     0.5 0.01  FALSE</span>
<span class="co">#&gt; 2      1        1     0.5 0.01  FALSE</span>
<span class="co">#&gt; 3      2        2     0.5 0.01  FALSE</span>
<span class="co">#&gt; 4      1        2     0.2 0.01  FALSE</span>
<span class="co">#&gt; 5      1        2     0.8 0.01  FALSE</span></code></pre></div>
<p>We can then run <em>CompareSim</em>, visualise the scenarios and their results using <em>summary</em> and plot their accuracy using <em>plot</em> or <em>autoplot</em>. You can use the parameter <em>parallel</em> of the <em>CompareSim</em> function to speed up the loop, in this case, you have to first load the <em>doParallel</em> library.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">VBS_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompareSim.html">CompareSim</a></span><span class="op">(</span>Param <span class="op">=</span> <span class="va">Param</span> ,
                       priors <span class="op">=</span> <span class="va">priors</span>, D2fill <span class="op">=</span> <span class="va">Data2fill</span>, DAsso <span class="op">=</span> <span class="va">DAsso</span>,
                       pc2fill <span class="op">=</span> <span class="fl">10</span>, pcFamilyDet <span class="op">=</span> <span class="fl">25</span>, pcGenusDet <span class="op">=</span> <span class="fl">25</span>, 
                       NbSim <span class="op">=</span> <span class="fl">10</span>, Results_Simulations <span class="op">=</span> <span class="cn">FALSE</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;  35.062   0.704  36.199</span>
<span class="co"># utilisateur     système      écoulé </span>
<span class="co">#       19.55        0.20       19.86 </span>

<span class="co"># system.time(VBS_test &lt;- CompareSim(Param = Param ,</span>
<span class="co">#                        priors = priors, D2fill = Data2fill, DAsso = DAsso,</span>
<span class="co">#                        pc2fill = 10, pcFamilyDet = 25, pcGenusDet = 25,</span>
<span class="co">#                        NbSim = 10, Results_Simulations = FALSE, parallel = TRUE))</span>
<span class="co"># utilisateur     système      écoulé </span>
<span class="co">#        0.19        0.56        8.96 </span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">VBS_test</span><span class="op">)</span>
<span class="co">#&gt; scenario a </span>
<span class="co">#&gt; 10  repetition(s) with priors nb 1 , dataAsso nb 2 , weights  0.5 , pc2fill 10 % , and eps 0.01 </span>
<span class="co">#&gt;        0%       25%       50%       75%      100% </span>
<span class="co">#&gt; 0.4693878 0.5127551 0.5255102 0.5484694 0.5714286 </span>
<span class="co">#&gt; scenario b </span>
<span class="co">#&gt; 10  repetition(s) with priors nb 1 , dataAsso nb 1 , weights  0.5 , pc2fill 10 % , and eps 0.01 </span>
<span class="co">#&gt;        0%       25%       50%       75%      100% </span>
<span class="co">#&gt; 0.4081633 0.4311224 0.4540816 0.4591837 0.5204082 </span>
<span class="co">#&gt; scenario c </span>
<span class="co">#&gt; 10  repetition(s) with priors nb 2 , dataAsso nb 2 , weights  0.5 , pc2fill 10 % , and eps 0.01 </span>
<span class="co">#&gt;        0%       25%       50%       75%      100% </span>
<span class="co">#&gt; 0.4489796 0.4770408 0.5000000 0.5204082 0.5408163 </span>
<span class="co">#&gt; scenario d </span>
<span class="co">#&gt; 10  repetition(s) with priors nb 1 , dataAsso nb 2 , weights  0.2 , pc2fill 10 % , and eps 0.01 </span>
<span class="co">#&gt;        0%       25%       50%       75%      100% </span>
<span class="co">#&gt; 0.5102041 0.5459184 0.5663265 0.5816327 0.6020408 </span>
<span class="co">#&gt; scenario e </span>
<span class="co">#&gt; 10  repetition(s) with priors nb 1 , dataAsso nb 2 , weights  0.8 , pc2fill 10 % , and eps 0.01 </span>
<span class="co">#&gt;        0%       25%       50%       75%      100% </span>
<span class="co">#&gt; 0.3979592 0.4107143 0.4234694 0.4515306 0.4693878</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">VBS_test</span><span class="op">)</span></code></pre></div>
<p><img src="compare_files/figure-html/Compare-1.png" width="80%"></p>
</div>
<div class="section level3">
<h3 id="testing-deterministic-associations">Testing deterministic associations<a class="anchor" aria-label="anchor" href="#testing-deterministic-associations"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,  
                    dataAsso <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, 
                    weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.2</span>,<span class="fl">0.8</span><span class="op">)</span>,
                    eps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span><span class="op">)</span>,
                    Determ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">Param</span>
<span class="co">#&gt;   priors dataAsso weights  eps Determ</span>
<span class="co">#&gt; 1      1        2     0.5 0.01   TRUE</span>
<span class="co">#&gt; 2      1        1     0.5 0.01   TRUE</span>
<span class="co">#&gt; 3      2        2     0.5 0.01   TRUE</span>
<span class="co">#&gt; 4      1        2     0.2 0.01   TRUE</span>
<span class="co">#&gt; 5      1        2     0.8 0.01   TRUE</span></code></pre></div>
<p>Here there will be lots of warning messages (not displayed here) in cases when two associations are equality likely. This also explain the variability of the accuracy plotted.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VBS_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompareSim.html">CompareSim</a></span><span class="op">(</span>Param <span class="op">=</span> <span class="va">Param</span> ,
                       priors <span class="op">=</span> <span class="va">priors</span>, D2fill <span class="op">=</span> <span class="va">Data2fill</span>, DAsso <span class="op">=</span> <span class="va">DAsso</span>,
                       pc2fill <span class="op">=</span> <span class="fl">10</span>, pcFamilyDet <span class="op">=</span> <span class="fl">25</span>, pcGenusDet <span class="op">=</span> <span class="fl">25</span>, 
                       NbSim <span class="op">=</span> <span class="fl">10</span>, Results_Simulations <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">VBS_test</span><span class="op">)</span>
<span class="co">#&gt; scenario a </span>
<span class="co">#&gt; 10  repetition(s) with priors nb 1 , dataAsso nb 2 , weights  0.5 , pc2fill 10 % , and eps 0.01 </span>
<span class="co">#&gt;        0%       25%       50%       75%      100% </span>
<span class="co">#&gt; 0.6734694 0.6836735 0.6887755 0.6938776 0.7040816 </span>
<span class="co">#&gt; scenario b </span>
<span class="co">#&gt; 10  repetition(s) with priors nb 1 , dataAsso nb 1 , weights  0.5 , pc2fill 10 % , and eps 0.01 </span>
<span class="co">#&gt;        0%       25%       50%       75%      100% </span>
<span class="co">#&gt; 0.5918367 0.6020408 0.6173469 0.6224490 0.6326531 </span>
<span class="co">#&gt; scenario c </span>
<span class="co">#&gt; 10  repetition(s) with priors nb 2 , dataAsso nb 2 , weights  0.5 , pc2fill 10 % , and eps 0.01 </span>
<span class="co">#&gt;        0%       25%       50%       75%      100% </span>
<span class="co">#&gt; 0.6836735 0.6836735 0.6887755 0.6938776 0.6938776 </span>
<span class="co">#&gt; scenario d </span>
<span class="co">#&gt; 10  repetition(s) with priors nb 1 , dataAsso nb 2 , weights  0.2 , pc2fill 10 % , and eps 0.01 </span>
<span class="co">#&gt;        0%       25%       50%       75%      100% </span>
<span class="co">#&gt; 0.7040816 0.7142857 0.7142857 0.7142857 0.7244898 </span>
<span class="co">#&gt; scenario e </span>
<span class="co">#&gt; 10  repetition(s) with priors nb 1 , dataAsso nb 2 , weights  0.8 , pc2fill 10 % , and eps 0.01 </span>
<span class="co">#&gt;        0%       25%       50%       75%      100% </span>
<span class="co">#&gt; 0.6836735 0.6836735 0.6836735 0.6913265 0.6938776</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">VBS_test</span><span class="op">)</span></code></pre></div>
<p><img src="compare_files/figure-html/Comparedeter-1.png" width="80%"></p>
</div>
<div class="section level3">
<h3 id="checking-stability-of-association-accuracy">Checking stability of association accuracy<a class="anchor" aria-label="anchor" href="#checking-stability-of-association-accuracy"></a>
</h3>
<p>We can plot the variability of the accuracy with increasing number of simulations used: 1, …, NbSim, with the function <em>stabletest</em>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,
                    dataAsso <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,
                    weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>,
                    eps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span><span class="op">)</span>,
                    Determ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">Param</span>
<span class="co">#&gt;   priors dataAsso weights  eps Determ</span>
<span class="co">#&gt; 1      2        2     0.5 0.01  FALSE</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VBS_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompareSim.html">CompareSim</a></span><span class="op">(</span>Param <span class="op">=</span> <span class="va">Param</span> ,
                       priors <span class="op">=</span> <span class="va">priors</span>, D2fill <span class="op">=</span> <span class="va">Data2fill</span>, DAsso <span class="op">=</span> <span class="va">DAsso</span>,
                       pc2fill <span class="op">=</span> <span class="fl">10</span>, pcFamilyDet <span class="op">=</span> <span class="fl">25</span>, pcGenusDet <span class="op">=</span> <span class="fl">25</span>, 
                       NbSim <span class="op">=</span> <span class="fl">10</span>, Results_Simulations <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="../reference/stabletest.html">stabletest</a></span><span class="op">(</span><span class="va">VBS_test</span>,<span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="compare_files/figure-html/Compare_stab-1.png" width="80%"></p>
<p>Here we see that we could increase the number of simulations, but it seems to be stabilized after 6 simulations.</p>
</div>
<div class="section level3">
<h3 id="comparing-different-sampled-datasets">Comparing different sampled datasets<a class="anchor" aria-label="anchor" href="#comparing-different-sampled-datasets"></a>
</h3>
<p>As CompareSim uses only one test dataset, we want to check the potential variability resulting from the sampling of the test dataset. This can be done with the <em>CompareSample</em> function. This function samples <em>NbSamples</em> test datasets and performs a comparison between scenarios for each test dataset. As for the function <em>CompareSim</em>, the option <em>parallel</em> can be set to <em>TRUE</em> to speed up the loop.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">Param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,  
                    dataAsso <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, 
                    weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span>,
                    eps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span><span class="op">)</span>,
                    Determ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">FALSE</span>,<span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">VBS_test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompareSample.html">CompareSample</a></span><span class="op">(</span>NbSamples <span class="op">=</span> <span class="fl">3</span>,Param <span class="op">=</span> <span class="va">Param</span> ,
                       priors <span class="op">=</span> <span class="va">priors</span>, D2fill <span class="op">=</span> <span class="va">Data2fill</span>, DAsso <span class="op">=</span> <span class="va">DAsso</span>,
                       pc2fill <span class="op">=</span> <span class="fl">10</span>, pcFamilyDet <span class="op">=</span> <span class="fl">25</span>, pcGenusDet <span class="op">=</span> <span class="fl">25</span>, 
                       NbSim <span class="op">=</span> <span class="fl">10</span>, Results_Simulations <span class="op">=</span> <span class="cn">FALSE</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;  67.901   1.013  69.844</span>
<span class="co"># utilisateur     système      écoulé </span>
<span class="co">#      35.08        0.42       36.48 </span>

<span class="co"># system.time(VBS_test2 &lt;- CompareSample(NbSamples = 3,Param = Param ,</span>
<span class="co">#                        priors = priors, D2fill = Data2fill, DAsso = DAsso,</span>
<span class="co">#                        pc2fill = 10, pcFamilyDet = 25, pcGenusDet = 25, </span>
<span class="co">#                        NbSim = 10, Results_Simulations = FALSE, parallel = TRUE))</span>
<span class="co"># utilisateur     système      écoulé </span>
<span class="co">#       0.48        0.61       21.78 </span>

<span class="co"># results with the first dataset</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">VBS_test2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="compare_files/figure-html/Compare_samples-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># results with the second dataset are a bit different</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">VBS_test2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="compare_files/figure-html/Compare_samples-2.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># all results together</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">accuracy</span>, x <span class="op">=</span> <span class="va">sample</span>, fill <span class="op">=</span> <span class="va">scenario</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">VBS_test2</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="compare_files/figure-html/Compare_samples-3.png" width="700"></p>
<p>Here, the ranking is preserved between different test datasets: scenario c gives better results. This confirms that the variability between scenarios is higher than the one between samplings. We can then choose a scenario according to this ranking.</p>
</div>
<div class="section level3">
<h3 id="examining-results-associations">Examining results associations<a class="anchor" aria-label="anchor" href="#examining-results-associations"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, 
                    dataAsso <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, 
                    weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>,
                    eps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span><span class="op">)</span>,
                    Determ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">Param</span>
<span class="co">#&gt;   priors dataAsso weights  eps Determ</span>
<span class="co">#&gt; 1      2        2     0.5 0.01  FALSE</span></code></pre></div>
<p>We now want to examine the association tree by tree. The simulations of each scenario (here just one) can be retrieved as a list of data.table.</p>
<p>In cases where the original data contained several censuses of a same plots (<em>i.e.</em> several lines per individual trees), the output contained in <em>results</em> keeps only one line per individual, and only a subset of colums from the original dataset (the ones that don’t change between censuses).</p>
<p>We can then look at each of the simulations: <em>TestData</em> indicates if the tree was used for test subset, and <em>ValidAsso</em> if the botanical association was correct.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VBS_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompareSim.html">CompareSim</a></span><span class="op">(</span>Param <span class="op">=</span> <span class="va">Param</span> ,
                       priors <span class="op">=</span> <span class="va">priors</span>, D2fill <span class="op">=</span> <span class="va">Data2fill</span>, DAsso <span class="op">=</span> <span class="va">DAsso</span>,
                       pc2fill <span class="op">=</span> <span class="fl">10</span>, pcFamilyDet <span class="op">=</span> <span class="fl">25</span>, pcGenusDet <span class="op">=</span> <span class="fl">25</span>, 
                       NbSim <span class="op">=</span> <span class="fl">10</span>, Results_Simulations <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">ResL</span> <span class="op">&lt;-</span> <span class="va">VBS_test</span><span class="op">@</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># here we get all the simulation of scenario 1</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ResL</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># first simulation</span>
<span class="co">#&gt; Classes 'data.table' and 'data.frame':   976 obs. of  12 variables:</span>
<span class="co">#&gt;  $ idTree       : Factor w/ 976 levels "100621","100622",..: 1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">#&gt;  $ Family       : chr  "Euphorbiaceae" "Arecaceae" "Sapotaceae" "Humiriaceae" ...</span>
<span class="co">#&gt;  $ Genus        : chr  "Sandwithia" "Oenocarpus" "Micropholis" "Sacoglottis" ...</span>
<span class="co">#&gt;  $ Species      : chr  "guyanensis" "bataua" "guyanensis" "guianensis" ...</span>
<span class="co">#&gt;  $ BotaSource   : chr  "Bota" "Bota" "Bota" "Bota" ...</span>
<span class="co">#&gt;  $ BotaCertainty: Factor w/ 6 levels "-1","0","1","2",..: 6 6 6 6 6 6 6 5 6 6 ...</span>
<span class="co">#&gt;  $ VernName     : Factor w/ 110 levels "-","acacia franc",..: 102 79 14 91 18 97 14 86 75 70 ...</span>
<span class="co">#&gt;  $ GenSp        : Factor w/ 205 levels "Indet.-Indet.",..: 165 133 124 164 186 203 1 92 134 105 ...</span>
<span class="co">#&gt;  $ GensSpCor    : Factor w/ 231 levels "Indet.-Indet.",..: 165 133 124 164 186 203 206 92 134 105 ...</span>
<span class="co">#&gt;  $ BotaCorCode  : Factor w/ 7 levels "fullyDet","NoCor",..: 1 1 1 1 1 1 3 1 1 1 ...</span>
<span class="co">#&gt;  $ ValidAsso    : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span>
<span class="co">#&gt;  $ TestData     : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span>
<span class="co">#&gt;  - attr(*, ".internal.selfref")=&lt;externalptr&gt; </span>
<span class="co">#&gt;  - attr(*, "sorted")= chr "idTree"</span></code></pre></div>
<p>We can also calculate the percentage of good association for each tested tree, for this scenario:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span>
<span class="va">Res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">ResL</span><span class="op">)</span> <span class="co"># combine them in a single data.table</span>
<span class="co"># calculate the percentage of good association for each tested tree</span>
<span class="va">PropGood</span> <span class="op">&lt;-</span> <span class="va">Res</span><span class="op">[</span><span class="va">TestData</span><span class="op">==</span><span class="cn">TRUE</span> <span class="op">&amp;</span> <span class="va">ValidAsso</span><span class="op">==</span><span class="cn">TRUE</span>,
                <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>propOK<span class="op">=</span><span class="va">.N</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ResL</span><span class="op">)</span><span class="op">)</span>, <span class="co"># number of correct association divided by number of association (NbSim)</span>
                by<span class="op">=</span><span class="va">idTree</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">PropGood</span><span class="op">)</span>
<span class="co">#&gt;    idTree propOK</span>
<span class="co">#&gt; 1: 100657    1.0</span>
<span class="co">#&gt; 2: 100660    0.6</span>
<span class="co">#&gt; 3: 100667    1.0</span>
<span class="co">#&gt; 4: 100671    1.0</span>
<span class="co">#&gt; 5: 100689    1.0</span>
<span class="co">#&gt; 6: 100690    0.2</span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Geraldine Derroire, Melaine Aubry-Kientz, Ariane Mirabel, Daniela Krebber, Eric Marcon, Bruno Herault.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
